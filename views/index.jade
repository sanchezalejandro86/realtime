doctype html
html
    head
        meta(name='viewport', content='width=device-width, initial-scale=1.0')
        meta(http-equiv='content-language', content='es')
        meta(name="robots" content="INDEX,FOLLOW")
        link(href='/stylesheets/bootstrap.min.css', rel='stylesheet', media='screen')
        link(href='/stylesheets/font-awesome.min.css', rel='stylesheet', media='screen')
        link(rel='stylesheet', href='/stylesheets/style.css')
    body
        .navbar.navbar-inverse.set-radius-zero
            .container
                .navbar-header
                    button.navbar-toggle(type="button", data-toggle="collapse", data-target=".navbar-collapse")
                        span.icon-bar
                        span.icon-bar
                        span.icon-bar
                    a.navbar-brand(href="/")
                        img(src="images/logo.png")
                .left-div
                    .user-settings-wrapper
                        ul.nav
                            li.dropdown
                                a.dropdown-toggle(data-toggle="dropdown", href="#", aria-expanded="false")
                                    span.glyphicon.glyphicon-user(style="font-size: 25px")
                                .dropdown-menu.dropdown-settings
                                    .media
                                        a.media-left(href="#")
                                            img.img-rounded(src="images/64-64.jpg", alt="")
                                        .media-body
                                            h4.media-heading Alejandro Sánchez
                                            h5 Administrador
                                    hr
                                    h5
                                        strong Biografía
                                    span Ingeniero en Sistemas de Información
                                    hr
                                    a.btn.btn-info.btn-sm(href="#") Perfil &nbsp;
                                    a.btn.btn-danger.btn-sm(href="#") Cerrar Sesión
        section.menu-section
            .container
                .row
                    .col-md-12
                        .navbar-collapse.collapse
                            ul.nav.navbar-nav.navbar-right#menu-top
                                li
                                    a.menu-top-active(href="#") Realtime
                                li
                                    a(href="#") Menu 2
                                li
                                    a(href="#") Menu 3
                                li
                                    a(href="#") Menu 4
                                li
                                    a(href="#") Menu 5

        .content-wrapper
            .container
                .row
                    .col-md-12#search-panel
                        script.
                              (function() {
                                var cx = '004468690808925015633:ehl2wqargfg';
                                var gcse = document.createElement('script');
                                gcse.type = 'text/javascript';
                                gcse.async = true;
                                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                                    '//cse.google.com/cse.js?cx=' + cx;
                                var s = document.getElementsByTagName('script')[0];
                                s.parentNode.insertBefore(gcse, s);
                              })();
                        gcse:search(disableWebSearch="true", enableImageSearch="true", image_lr="lang_en")
                        //.gcse-searchbox(data-disableWebSearch="true", data-enableImageSearch="true")
                .row
                    //.col-md-6#page-wrap
                        #chat-wrap
                            #chat-area
                        #send-message-area
                            textarea#sendie
                    .col-md-6
                        #chatEtherpad
                    block video
                .row
                    block videosExtra

        footer
            .container
                .row
                    .col-md-12 &copy; 2015 Unlimited Solutions

        script(type='text/javascript', src='/javascripts/jquery-2.1.4.min.js')
        script(type='text/javascript', src='/javascripts/bootstrap.min.js')
        script(type='text/javascript', src='/javascripts/socket.io-1.3.5.js')
        script(type='text/javascript', src='/javascripts/peer.js')
        script(type='text/javascript', src='/javascripts/etherpad.js')
        script.
            var socket = io();
            var peer = new Peer({key: 'bp70suzmx5ok1emi'});
            var mediaStream = null;
            var classRoom = '#{classRoom}';

            function sendSearch(){
                socket.emit('search changed', { text: $("input.gsc-input").val(), classRoom: classRoom});
            }
            function sendSearch2(e){
                if(e.which == 17){ //Activa la busqueda con el CTRL
                    $('input.gsc-search-button').click();
                }
            }

            function activateSearchEvents(){
                $("#search-panel").on("click", "input.gsc-search-button", sendSearch);
                $("#search-panel").on("keyup", ".gsc-input", sendSearch2);

            }

            function deactivateSearchEvents(){
                $("#search-panel").off("click", "input.gsc-search-button", sendSearch);
                $("#search-panel").off("keyup", ".gsc-input", sendSearch2);
            }

            $(document).ready(function(){
                var padId = 'realtimePortugues_' + classRoom;
                $('#chatEtherpad').pad({
                        'padId' : padId,
                        'width' : 600,
                        'height' : 400,
                        'showControls' : true
                    }
                );

                activateSearchEvents();

                socket.on('search changed', function(data){
                    if(data.classRoom == classRoom){
                        $('input.gsc-input').val(data.text);
                        deactivateSearchEvents();
                        $('input.gsc-search-button').click();
                        activateSearchEvents();
                    }
                });

                navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                navigator.getUserMedia({audio: true, video:true},
                function(localMediaStream){
                   mediaStream = localMediaStream;
                   var selfVideo = document.getElementById('selfVideo');
                   selfVideo.src = window.URL.createObjectURL(localMediaStream);
                },function(err) {
                   console.log('The following error occurred when trying to use getUserMedia: ' + err);
                });

                /*
                $("#sendie").keyup(function(e){
                    if(e.which == 13){
                        var text = $.trim($("#sendie").val());
                        if(text != ""){
                            var randomInputId = Math.floor((Math.random() * 1000000000) + 1);
                            socket.emit('newMessageChat', { message: text, inputId: randomInputId });
                            $("#sendie").val("");
                        }
                    }
                });

                $("#chat-area").on("keyup", ".chatInput", function(e){
                    if(e.which == 13){
                        var inputId = e.target.id;
                        var inputValue = $.trim($("#" + inputId).val());
                        if(inputValue != ""){
                            socket.emit('messageChatChanged', { message: inputValue, inputId: inputId});
                        }
                    }
                });

                socket.on('newMessageChat', function (data) {
                    $('#chat-area').append('<input id="'+data.inputId+'" type="text" class="input form-control chatInput" value="'+ data.message +'"></input>');
                    document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
                });

                socket.on('messageChatChanged', function (data) {
                    $("#" + data.inputId).val(data.message);
                });
                */
            });
        block javascript