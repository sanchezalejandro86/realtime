<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="content-language" content="es"><meta name="robots" content="INDEX,FOLLOW"><link href="/stylesheets/bootstrap.min.css" rel="stylesheet" media="screen"><link href="/stylesheets/font-awesome.min.css" rel="stylesheet" media="screen"><link rel="stylesheet" href="/stylesheets/style.css"></head><body><header><div class="navbar navbar-inverse set-radius-zero"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand"><img src="images/logo.png"></a></div><div class="left-div"><div class="user-settings-wrapper"><ul class="nav"><li class="dropdown"><a data-toggle="dropdown" href="#" aria-expanded="false" class="dropdown-toggle"><span style="font-size: 25px" class="glyphicon glyphicon-user"></span></a><div class="dropdown-menu dropdown-settings"><div class="media"><a href="#" class="media-left"><img src="images/64-64.jpg" alt="" class="img-rounded"></a><div class="media-body"><h4 class="media-heading">Alejandro Sánchez</h4><h5>Administrador</h5></div></div><hr><h5><strong>Biografía</strong></h5><span>Ingeniero en Sistemas de Información</span><hr><a href="#" class="btn btn-info btn-sm">Perfil &nbsp;</a><a href="#" class="btn btn-danger btn-sm">Cerrar Sesión</a></div></li></ul></div></div></div></div><section class="menu-section"><div class="container"><div class="row"><div class="col-md-12"><div class="navbar-collapse collapse"><ul id="menu-top" class="nav navbar-nav navbar-right"><li><a href="#" class="menu-top-active">Realtime</a></li><li><a href="#">Menu 2</a></li><li><a href="#">Menu 3</a></li><li><a href="#">Menu 4</a></li><li><a href="#">Menu 5</a></li></ul></div></div></div></div></section></header><content><div class="content-wrapper"><div class="container"><div class="row"><div class="col-md-6"><div id="search-panel" class="row"><script>(function() {
  var cx = '004468690808925015633:ehl2wqargfg';
  var gcse = document.createElement('script');
  gcse.type = 'text/javascript';
  gcse.async = true;
  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(gcse, s);
})();</script><gcse:searchbox gname="storesearch" disableWebSearch="true" enableImageSearch="true" image_lr="lang_en"></gcse:searchbox></div><div class="row"><gcse:searchresults gname="storesearch"></gcse:searchresults></div></div><div class="col-md-6"><div class="row"><div class="col-md-12"><div id="chat-wrap"><div id="chat-area"></div></div></div></div><div class="row"><div class="col-md-3"><video id="profesorVideo" height="100px" autoplay></video></div><div class="col-md-9"><div id="send-message-area"><textarea id="sendie"></textarea></div></div></div></div></div><!--.row.col-md-6
    #send-message-area
        textarea#sendie
block video
--><div class="row"><!--.col-md-6video#selfVideo(height="400px",autoplay,muted)--><div class="row"><div class="col-md-6"><p>Nombre:</p><input id="name" type="text" value="Alumno"></div></div><div class="row"><div class="col-md-6"><br><button id="conectar">CONECTAR CON PROFESOR</button></div></div></div></div></div></content><footer><div class="container"><div class="row"><div class="col-md-12">&copy; 2015 Unlimited Solutions</div></div></div></footer><script type="text/javascript" src="/javascripts/jquery-2.1.4.min.js"></script><script type="text/javascript" src="/javascripts/bootstrap.min.js"></script><script type="text/javascript" src="/javascripts/socket.io-1.3.5.js"></script><script type="text/javascript" src="/javascripts/peer.js"></script><!--script(type='text/javascript', src='/javascripts/etherpad.js')--><script>var socket = io();
var peer = new Peer({key: 'bp70suzmx5ok1emi'});
var mediaStream = null;
var classRoom = '';

function onlySearch(){
        deactivateSearchEvents();
        $('input.gsc-search-button').click();
        activateSearchEvents();
}
function sendSearch(){
    socket.emit('search changed', { text: $("input.gsc-input").val(), classRoom: classRoom});
}
function searchKeyUp(e){
    if (e.which == 17){ //Activa la busqueda con el CTRL
        $('input.gsc-search-button').click();
    } else {
        onlySearch();
    }
}

var sp = $("#search-panel");

function activateSearchEvents(){
    sp.on("click", "input.gsc-search-button", sendSearch);
    sp.on("keyup", ".gsc-input", searchKeyUp);
    //sp.on("input", "input.gsc-input", onlySearch);
}

function deactivateSearchEvents(){
    sp.off("click", "input.gsc-search-button", sendSearch);
    sp.off("keyup", ".gsc-input", searchKeyUp);
}

if(!window.Kolich){
  Kolich = {};
}

Kolich.Selector = {};
Kolich.Selector.getSelected = function(){
  var t = '';
  if(window.getSelection){
    t = window.getSelection();
  }else if(document.getSelection){
    t = document.getSelection();
  }else if(document.selection){
    t = document.selection.createRange().text;
  }
  return t;
};

Kolich.Selector.mouseup = function(){
    var st = Kolich.Selector.getSelected();
    if (st == '') return;

    var input = $('input.gsc-input');
    if (input.val() != "") //--Agregar coma
        st = ", " + st;

    input.val(input.val() + st);
    input.focus();
    onlySearch();
};

$(document).ready(function(){
    activateSearchEvents();

    $('#chat-area,#sendie').bind("mouseup", Kolich.Selector.mouseup);

    //************SOCKET EVENTS********************//
    socket.on('search changed', function(data){
        if (data.classRoom == classRoom){
            $('input.gsc-input').val(data.text);
            deactivateSearchEvents();
            $('input.gsc-search-button').click();
            activateSearchEvents();
        }
    });

    socket.on('newMessageChat', function (data) {
        if (data.classRoom == classRoom){
            addChatMsg(data, false);
        }
    });

    socket.on('messageChatChanged', function (data) {
        if (data.classRoom == classRoom){
            $("#" + data.inputId + ' .msg-text').text(data.message);
        }
    });
    //**********************************************//

    $('#sendie').keydown(function (e) {
        if (!(e.which == 13 && !e.shiftKey)) return; //--Con ENTER y sin SHIFT => enviar

        var sendie = $('#sendie');
        var text = $.trim(sendie.val());
        if (text == "") return;

        var data = { message: text, inputId: Date.now() , classRoom: classRoom, sender: $('#name').val()};
        socket.emit('newMessageChat', data);
        addChatMsg(data, true);
        sendie.val("");
        e.preventDefault();
    });

    $("#chat-area").on("keydown", ".chatInput .msg-text", function(e){
        if (e.which != 13 || e.shiftKey) return;

        var inputId = $(e.target).parent().attr('id');
        var item = $("#" + inputId);
        var inputValue = $(e.target).text();

        socket.emit('messageChatChanged', { message: inputValue, inputId: inputId, classRoom: classRoom});

        item.removeClass('msg-pending');
        e.preventDefault();
    });

    $('#chat-area').on('input', '.chatInput .msg-text', function(e){
        $(e.target).parent().addClass('msg-pending');
    });

    function addChatMsg(data, sent){
        var date = new Date(data.inputId);
        var msg =
                '<div contentEditable="false" id="' + data.inputId + '" \
                    class="form-control chatInput ' + (sent? 'msg-sent' : 'msg-rcv')+ '" data-sender="' + data.sender + '">\
                    <span class="msg-text" contenteditable="true">' + data.message + '</span>\
                    <span contenteditable="false" class="msg-date">' +
                    date.getDate() + "/" + (date.getMonth()+1) + ' ' + date.getHours() + ':' + date.getMinutes() + '</span>\
                </div>';

        var chat_area = $('#chat-area');
        var last = $('#chat-area>*:last-child');

        if (last.length == 0 || data.sender != last.data('sender'))
            chat_area.append('\
                    <hr class="chat-separator">\
                    <span class="msg-sender ' + (sent? 'msg-sender-sent' : 'msg-sender-rcv') + '">' +
                    data.sender.substring(0, 9) + '</span>');

        chat_area.append(msg);
        document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
    }

    jQuery.fn.justtext = function () {
        return $(this).clone()
                .children()
                .remove()
                .end()
                .text();
    };
});
</script><script>var peerId;
$(document).ready(function(){
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    navigator.getUserMedia({audio: true, video:false},
    function(localMediaStream){
       mediaStream = localMediaStream;
       //var selfVideo = document.getElementById('selfVideo');
       //selfVideo.src = window.URL.createObjectURL(localMediaStream);
    },function(err) {
       console.log('The following error occurred when trying to use getUserMedia: ' + err);
    });

    $("#conectar").hide();
    $("#profesorVideo").hide();

    peer.on('open', function (id) {
        peerId = id;
        $("#conectar").show();
        $("#profesorVideo").show();
    });

    $("#conectar").click(function(){
        socket.emit('newStudentConnected', { peerId: peerId, classRoom: classRoom});
    //     $("#conectar").hide();
    });

    peer.on('call', function (call) {
        call.answer(mediaStream);
        call.on('stream', function (stream) {
            var profesorVideo = document.getElementById('profesorVideo');
            profesorVideo.src = window.URL.createObjectURL(stream);
        });
    });
});</script></body></html>