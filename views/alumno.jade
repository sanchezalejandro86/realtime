extends ./index.jade

block video
    .col-md-3
        video#profesorVideo(height="100px",autoplay)

block videosExtra
    //.col-md-6
        video#selfVideo(height="400px",autoplay,muted)
    .col-md-6
        button#conectar CONECTAR CON PROFESOR

block javascript
    script.
        var peerId;
        $(document).ready(function(){
            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
            navigator.getUserMedia({audio: true, video:false},
            function(localMediaStream){
               mediaStream = localMediaStream;
               //var selfVideo = document.getElementById('selfVideo');
               //selfVideo.src = window.URL.createObjectURL(localMediaStream);
            },function(err) {
               console.log('The following error occurred when trying to use getUserMedia: ' + err);
            });

            $("#conectar").hide();
            $("#profesorVideo").hide();

            peer.on('open', function (id) {
                peerId = id;
                $("#conectar").show();
                $("#profesorVideo").show();
            });

            $("#conectar").click(function(){
                socket.emit('newStudentConnected', { peerId: peerId, classRoom: classRoom});
            //     $("#conectar").hide();
            });

            peer.on('call', function (call) {
                call.answer(mediaStream);
                call.on('stream', function (stream) {
                    var profesorVideo = document.getElementById('profesorVideo');
                    profesorVideo.src = window.URL.createObjectURL(stream);
                });
            });
        });